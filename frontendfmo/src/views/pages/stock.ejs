<!DOCTYPE html>
<html lang="es">

<head>
    <%- include('../partials/head') %>
    <title>Inventario y Asignaciones</title>
    <style>
        /* --- PALETA FMO --- */
        :root {
            --fmo-red-dark: #dd0303;
            --fmo-red: #d6291c;
            --fmo-orange-red: #f25912;
            --fmo-orange: #fa812f;
            --fmo-yellow: #fab12f;
        }

        /* Tarjetas de Resumen */
        .stock-card {
            border: none;
            border-radius: 15px;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            overflow: hidden;
            position: relative;
            border-left: 5px solid var(--fmo-red);
        }
        .stock-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(221, 3, 3, 0.15) !important;
        }
        .icon-bg {
            position: absolute;
            right: -20px;
            bottom: -20px;
            font-size: 5rem;
            opacity: 0.15;
            transform: rotate(-15deg);
            color: var(--fmo-red);
        }

        /* Tabla Estilizada */
        .table-custom thead {
            background: linear-gradient(135deg, var(--fmo-red-dark), var(--fmo-orange-red));
            color: white;
        }
        .table-custom tbody tr:hover {
            background-color: #fff5f5;
        }

        .btn-fmo {
            background: linear-gradient(to right, var(--fmo-red), var(--fmo-orange-red));
            border: none;
            color: white;
        }
        .btn-fmo:hover {
            background: linear-gradient(to right, var(--fmo-red-dark), var(--fmo-red));
            color: white;
            box-shadow: 0 4px 10px rgba(214, 41, 28, 0.3);
        }

        .nav-tabs .nav-link.active {
            color: var(--fmo-red-dark);
            border-top: 3px solid var(--fmo-red);
            font-weight: bold;
        }
        .nav-tabs .nav-link {
            color: #666;
        }
    </style>
</head>

<body>
    <div class="wrapper">
        <%- include('../partials/sidebar') %>

        <div id="content" class="w-100 bg-light p-4">
            
            <div class="d-flex justify-content-between align-items-center mb-4 fade-in">
                <div>
                    <h4 class="m-0 fw-bold text-dark">
                        <i class="bi bi-box-seam-fill text-fmo-primary me-2"></i>Control de Inventario
                    </h4>
                    <p class="text-muted small m-0">Gestión de componentes, periféricos y asignaciones.</p>
                </div>
                <button class="btn btn-fmo shadow-sm" onclick="abrirModalAgregar()">
                    <i class="bi bi-plus-circle me-2"></i>Registrar Nuevo Item
                </button>
            </div>

            <div class="row g-4 mb-4 fade-in">
                <div class="col-md-6">
                    <div class="card stock-card bg-white shadow-sm p-3 h-100">
                        <div class="d-flex justify-content-between align-items-center position-relative z-1">
                            <div>
                                <h6 class="text-muted text-uppercase fw-bold" style="font-size: 0.8rem;">Items Disponibles</h6>
                                <h2 class="fw-bold text-primary mb-0" id="totalLibres">0</h2>
                            </div>
                            <div class="icon-bg text-primary"><i class="bi bi-check-circle" style="color: #0d6efd;"></i></div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card stock-card bg-white shadow-sm p-3 h-100" style="border-left-color: #198754;">
                        <div class="d-flex justify-content-between align-items-center position-relative z-1">
                            <div>
                                <h6 class="text-muted text-uppercase fw-bold" style="font-size: 0.8rem;">Items Asignados</h6>
                                <h2 class="fw-bold text-success mb-0" id="totalAsignados">0</h2>
                            </div>
                            <div class="icon-bg text-success"><i class="bi bi-person-check-fill" style="color: #198754;"></i></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card shadow-sm border-0 fade-in">
                <div class="card-header bg-white border-bottom-0 pt-3 px-4">
                    <ul class="nav nav-tabs card-header-tabs" id="stockTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="stock-tab" data-bs-toggle="tab" data-bs-target="#tab-stock" type="button">
                                <i class="bi bi-list-ul me-2"></i>Inventario General
                            </button>
                        </li>
                        </ul>
                </div>
                
                <div class="card-body p-0">
                    <div class="tab-content">
                        
                        <div class="tab-pane fade show active" id="tab-stock">
                            <div class="table-responsive">
                                <table class="table table-custom align-middle mb-0">
                                    <thead>
                                        <tr>
                                            <th>Categoría / Item</th>
                                            <th>Detalles Técnicos</th>
                                            <th>Serial (Único)</th>
                                            <th class="text-center">Estado</th>
                                            <th class="text-center">Acciones</th>
                                        </tr>
                                    </thead>
                                    <tbody id="tablaStock">
                                        </tbody>
                                </table>
                            </div>
                        </div>

                    </div>
                </div>
            </div>

        </div>
    </div>

    <div class="modal fade" id="modalStock" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-gradient text-white" style="background: var(--fmo-red);">
                    <h5 class="modal-title fw-bold"><i class="bi bi-qr-code-scan me-2"></i>Registrar Item</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="formStock">
                        <div class="mb-3">
                            <label class="form-label fw-bold small text-muted">Categoría</label>
                            <select class="form-select" id="selCategoria" onchange="cargarListaItems()">
                                <option value="COMPONENTE">Componente Interno</option>
                                <option value="PERIFERICO">Periférico Externo</option>
                            </select>
                        </div>

                        <div class="mb-3">
                            <label class="form-label fw-bold small text-muted">Tipo de Artículo</label>
                            <select class="form-select" id="selReferencia" required></select>
                        </div>

                        <div class="row g-2 mb-3">
                            <div class="col-6">
                                <label class="form-label fw-bold small text-muted">Marca</label>
                                <input type="text" class="form-control" id="inputMarca" placeholder="Ej: HP" required>
                            </div>
                            <div class="col-6">
                                <label class="form-label fw-bold small text-muted">Serial</label>
                                <input type="text" class="form-control" id="inputSerial" placeholder="SN-12345" required>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label fw-bold small text-muted">Características / Modelo</label>
                            <textarea class="form-control" id="inputCaract" rows="2" placeholder="Ej: 16GB RAM, Negro, USB..."></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-fmo" onclick="guardarNuevoStock()">Guardar Registro</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="modalAsignar" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-success text-white">
                    <h5 class="modal-title fw-bold"><i class="bi bi-person-check-fill me-2"></i>Asignar a Trabajador</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-light border-start border-4 border-success">
                        <strong id="lblItemAsignar"></strong> <br>
                        <small class="text-muted" id="lblSerialAsignar"></small>
                    </div>
                    
                    <form id="formAsignar">
                        <input type="hidden" id="hdnIdStockAsignar">
                        
                        <h6 class="text-success fw-bold border-bottom pb-1 mb-3">Datos del Equipo y Fecha</h6>
                        <div class="row g-2 mb-3">
                            <div class="col-6">
                                <label class="form-label small fw-bold">FMO Equipo</label>
                                <input type="text" class="form-control" id="asigFmo" placeholder="Ej: 998877" required>
                            </div>
                            <div class="col-6">
                                <label class="form-label small fw-bold">Fecha</label>
                                <input type="date" class="form-control" id="asigFecha" required>
                            </div>
                        </div>

                        <h6 class="text-success fw-bold border-bottom pb-1 mb-3">Datos del Usuario</h6>
                        <div class="row g-2 mb-2">
                            <div class="col-4">
                                <label class="form-label small fw-bold">Ficha</label>
                                <input type="number" class="form-control" id="asigFicha" required>
                            </div>
                            <div class="col-8">
                                <label class="form-label small fw-bold">Nombre Completo</label>
                                <input type="text" class="form-control" id="asigNombre" required>
                            </div>
                        </div>
                        <div class="row g-2">
                            <div class="col-6">
                                <label class="form-label small fw-bold">Gerencia</label>
                                <input type="text" class="form-control" id="asigGerencia">
                            </div>
                            <div class="col-6">
                                <label class="form-label small fw-bold">Extensión</label>
                                <input type="text" class="form-control" id="asigExtension">
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-success" onclick="ejecutarAsignacion()">Confirmar Asignación</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="modalDesvincular" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-warning text-dark">
                    <h5 class="modal-title fw-bold"><i class="bi bi-link-45deg me-2"></i>Desvincular Item</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body text-center p-4">
                    <p class="fs-5">¿Desea liberar el item con serial <strong id="lblSerialDesvincular"></strong>?</p>
                    <p class="small text-muted">El item regresará al estado "Disponible" en el inventario.</p>
                </div>
                <div class="modal-footer justify-content-center">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-warning fw-bold" onclick="ejecutarDesvinculacion()">Sí, Liberar</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="modalEliminar" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title fw-bold">Eliminar Definitivamente</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body text-center">
                    <p class="fs-5">¿Borrar el registro del inventario?</p>
                    <small class="text-danger">Esta acción no se puede deshacer.</small>
                </div>
                <div class="modal-footer justify-content-center">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-danger" onclick="ejecutarEliminacionDb()">Eliminar</button>
                </div>
            </div>
        </div>
    </div>
<div class="modal fade" id="modalVerRelacion" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0 shadow">
            <div class="modal-header text-white" style="background: linear-gradient(to right, #0d6efd, #0dcaf0);">
                <h5 class="modal-title fw-bold">
                    <i class="bi bi-info-circle-fill me-2"></i>Detalle de Asignación
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body p-4 bg-light">
                <div class="card mb-3 border-0 shadow-sm">
                    <div class="card-body d-flex justify-content-between align-items-center">
                        <div>
                            <small class="text-muted fw-bold">ITEM</small>
                            <h5 class="mb-0 fw-bold text-dark" id="view_nombreItem"></h5>
                        </div>
                        <div class="text-end">
                            <small class="text-muted fw-bold">SERIAL</small>
                            <div class="badge bg-dark fs-6 font-monospace" id="view_serial"></div>
                        </div>
                    </div>
                </div>

                <h6 class="text-primary fw-bold border-bottom pb-2 mb-3">Ubicación Actual</h6>
                
                <div class="row g-3">
                    <div class="col-6">
                        <label class="small text-muted fw-bold">FMO Equipo</label>
                        <p class="fs-5 fw-bold text-dark mb-0" id="view_fmo"></p>
                    </div>
                    <div class="col-6 text-end">
                        <label class="small text-muted fw-bold">Fecha Asignación</label>
                        <p class="fs-6 mb-0" id="view_fecha"></p>
                    </div>
                    
                    <div class="col-12"><hr class="my-1 text-muted opacity-25"></div>
                    
                    <div class="col-8">
                        <label class="small text-muted fw-bold">Usuario Responsable</label>
                        <p class="fw-bold text-dark mb-0" id="view_usuario"></p>
                        <small class="text-muted" id="view_gerencia"></small>
                    </div>
                    <div class="col-4 text-end">
                        <label class="small text-muted fw-bold">Ficha</label>
                        <div class="fw-bold text-primary" id="view_ficha"></div>
                        <small class="d-block mt-1">Ext: <span id="view_ext"></span></small>
                    </div>
                </div>
            </div>
            <div class="modal-footer bg-light">
                <button type="button" class="btn btn-secondary w-100" data-bs-dismiss="modal">Cerrar</button>
            </div>
        </div>
    </div>
</div>
    <%- include('../partials/modal') %>

    <script src="/js/utils/api.js"></script>
    <script src="/js/bootstrap/bootstrap.bundle.min.js"></script>
    <script src="/js/scripts/stock.js"></script>
</body>
</html>